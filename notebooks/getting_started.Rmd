---
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.16.4
  kernelspec:
    display_name: birder
    language: python
    name: birder
---

```{python}
# Simulate birder installed from package
# %cd ..
```

```{python}
import torch
import torch.nn.functional as F
from PIL import Image
```

```{python}
import birder
from birder.core.results.gui import show_top_k
```

```{python}
birder.list_pretrained_models("mobile*il-common*")
```

```{python}
(net, class_to_idx, signature, rgb_valuse) = birder.load_pretrained_model("xcit_nano16_il-common", inference=True)
size = birder.get_size_from_signature(signature)
transform = birder.classification_transform(size, rgb_valuse)
```

```{python}
image_path = "data/example.jpeg"
birder.common.cli.download_file("https://f000.backblazeb2.com/file/birder/data/img_001.jpeg", image_path)
```

```{python}
img = Image.open(image_path)
input_tensor = transform(img).unsqueeze(dim=0)
out = F.softmax(net(input_tensor), dim=1).cpu().numpy()
show_top_k(image_path, out.squeeze(), class_to_idx["Eurasian teal"], class_to_idx)
```

```{python}
transform = birder.classification_transform(size, rgb_valuse, center_crop=0.5)

input_tensor = transform(img).unsqueeze(dim=0)
out = F.softmax(net(input_tensor), dim=1).cpu().numpy()
show_top_k("data/example.jpeg", out.squeeze(), class_to_idx["Eurasian teal"], class_to_idx)
```

```{python}

```

```{python}
from birder.datahub.classification import CUB_200_2011
```

```{python}
training_dataset = CUB_200_2011(download=True)
validation_dataset = CUB_200_2011(split="validation")
```

```{python}
for img_path, cls in validation_dataset.imgs:
    if cls == 45:  # Gadwell
        img = Image.open(img_path)
        break
```

```{python}
input_tensor = transform(img).unsqueeze(dim=0).to(device)
```

```{python}
idx_to_class[net(input_tensor).argmax().item()]
```

```{python}

```
